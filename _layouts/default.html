<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ page.title | default: site.title }}</title>
    <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}">
    
    <!-- KaTeX CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css" integrity="sha384-GvrOXuhMATgEsSwCs4smul74iXGOixntILdUW9XmUC6+HX0sLNAK3q71HotJqlAn" crossorigin="anonymous">
    
    <!-- KaTeX JavaScript -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js" integrity="sha384-cpW21h6RZv/phavutF+AuVYrr+dA8xD9zs6FwLpaCct6O9ctzYFfFr4dgmgccOTx" crossorigin="anonymous"></script>
    
    <!-- KaTeX auto-render extension -->
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
    
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            renderMathInElement(document.body, {
                delimiters: [
                    {left: '$$', right: '$$', display: true},
                    {left: '$', right: '$', display: false},
                    {left: '\\(', right: '\\)', display: false},
                    {left: '\\[', right: '\\]', display: true}
                ]
            });
            console.log('KaTeX rendering complete!');
        });
    </script>
    
    <style>
        /* KaTeX styling fixes */
        .katex { 
            font-size: 1.1em !important; 
        }
        .katex-display { 
            margin: 1em 0 !important; 
        }
    </style>
</head>
<body{% if page.no_toc %} class="no-toc"{% endif %}>
    <!-- Header Section -->
    <header class="site-header">
        <div class="hero-section">
            <div class="hero-content">
                <div class="hero-header">
                    <a href="https://community.amstat.org/biop/home" target="_blank" rel="noopener noreferrer" class="logo-link">
                        <img src="{{ '/asa_biopharm_logo.png' | relative_url }}" 
                             alt="ASA Biopharmaceutical Section" 
                             class="sponsor-logo">
                    </a>
                    <div class="hero-text">
                        <h1>UNDER CONSTRUCTION</h1>
                        <h2>Oncology Treatment Switch Workstream</h2>
                    </div>
                </div>
                
                <div class="hero-description">
                    Advanced statistical methods to address treatment switching in oncology trials
                </div>
            </div>
        </div>
        
        <!-- Navigation Menu -->
        <nav class="site-nav">
            <div class="nav-container">
                <a href="{{ '/' | relative_url }}">Home</a>
        <!--        <a href="{{ '/objectives' | relative_url }}">Objectives</a>  -->
                <a href="{{ '/members' | relative_url }}">Members</a>
                <div class="dropdown">
                    <a href="{{ '/methods' | relative_url }}">Methods â–¼</a>
                    <div class="dropdown-content">
                        <a href="{{ '/methods/overview' | relative_url }}">Overview</a>
                        <a href="{{ '/methods/rpsft' | relative_url }}">RPSFT</a>
                        <a href="{{ '/methods/ipe' | relative_url }}">IPE</a>
                        <a href="{{ '/methods/ipcw' | relative_url }}">IPCW</a>
                        <a href="{{ '/methods/tse' | relative_url }}">TSE</a>
                        <a href="{{ '/methods/msm' | relative_url }}">MSM</a>
                    </div>
                </div>
                <a href="{{ '/seminars' | relative_url }}">Seminars</a>
                <a href="{{ '/resources' | relative_url }}">Resources</a>
                <!-- NEW: Interactive Analysis Link
                <a href="{{ '/interactive' | relative_url }}" class="interactive-link">ðŸ”¬ Interactive R</a>
                -->
            </div>
        </nav>
    </header>
    
    <!-- Table of Contents - Only show on content pages -->
    {% unless page.no_toc %}
    <!-- Mobile TOC Toggle Button -->
    <button class="toc-toggle" onclick="toggleTOC()" aria-label="Toggle Table of Contents">â˜°</button>
    
    <!-- Mobile Backdrop -->
    <div class="toc-backdrop" onclick="closeTOC()"></div>
    
    <!-- Table of Contents -->
    <nav class="floating-toc" id="floating-toc" aria-label="Table of Contents">
        <h3>On This Page</h3>
        <ul class="toc-list" id="toc-list">
            <!-- TOC items will be generated by JavaScript -->
        </ul>
    </nav>
    {% endunless %}
    
    <!-- Main Content Area -->
    <main class="page-content">
        <div class="wrapper">
            {{ content }}
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="site-footer">
        <div class="wrapper">
            <p>&copy; {{ 'now' | date: '%Y' }} ASA Biopharmaceutical Section - Oncology Treatment Switch Workstream</p>
        </div>
    </footer>
    
    <!-- JavaScript for interactive features -->
    <script src="{{ '/assets/js/main.js' | relative_url }}"></script>
    
    <!-- TOC JavaScript -->
    {% unless page.no_toc %}
    <script>
        // Generate TOC automatically
        function generateTOC() {
            const tocList = document.getElementById('toc-list');
            const headings = document.querySelectorAll('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]');
            
            if (headings.length === 0) {
                document.getElementById('floating-toc').style.display = 'none';
                const toggleButton = document.querySelector('.toc-toggle');
                if (toggleButton) toggleButton.style.display = 'none';
                return;
            }

            tocList.innerHTML = '';

            headings.forEach(heading => {
                const level = heading.tagName.toLowerCase();
                const id = heading.getAttribute('id');
                const text = heading.textContent;

                const listItem = document.createElement('li');
                listItem.className = 'toc-item';

                const link = document.createElement('a');
                link.href = `#${id}`;
                link.textContent = text;
                link.className = `toc-link level-${level.charAt(1)}`;
                
                // Add smooth scrolling behavior
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const target = document.getElementById(id);
                    if (target) {
                        target.scrollIntoView({ behavior: 'smooth' });
                        // Update active state
                        updateActiveLink(link);
                        // Close mobile TOC if open
                        if (window.innerWidth <= 768) {
                            closeTOC();
                        }
                    }
                });

                listItem.appendChild(link);
                tocList.appendChild(listItem);
            });
        }

        // Update active link based on scroll position
        function updateActiveLink(clickedLink = null) {
            const links = document.querySelectorAll('.toc-link');
            const headings = document.querySelectorAll('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]');
            
            if (clickedLink) {
                links.forEach(link => link.classList.remove('active'));
                clickedLink.classList.add('active');
                return;
            }

            let activeHeading = null;
            const scrollPosition = window.scrollY + 250; // Offset for your header

            headings.forEach(heading => {
                if (heading.offsetTop <= scrollPosition) {
                    activeHeading = heading;
                }
            });

            links.forEach(link => link.classList.remove('active'));
            
            if (activeHeading) {
                const activeLink = document.querySelector(`a[href="#${activeHeading.id}"]`);
                if (activeLink) {
                    activeLink.classList.add('active');
                }
            }
        }

        // Mobile TOC functions
        function toggleTOC() {
            const toc = document.getElementById('floating-toc');
            const backdrop = document.querySelector('.toc-backdrop');
            
            if (toc.classList.contains('show')) {
                closeTOC();
            } else {
                openTOC();
            }
        }

        function openTOC() {
            const toc = document.getElementById('floating-toc');
            const backdrop = document.querySelector('.toc-backdrop');
            
            toc.classList.add('show');
            toc.classList.remove('hidden');
            backdrop.classList.add('show');
        }

        function closeTOC() {
            const toc = document.getElementById('floating-toc');
            const backdrop = document.querySelector('.toc-backdrop');
            
            toc.classList.remove('show');
            backdrop.classList.remove('show');
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Wait a bit for KaTeX to render first
            setTimeout(function() {
                generateTOC();
                
                // Update active link on scroll
                window.addEventListener('scroll', updateActiveLink);
                
                // Handle window resize
                window.addEventListener('resize', function() {
                    if (window.innerWidth > 768) {
                        closeTOC();
                    }
                });
                
                // Initial active link update
                updateActiveLink();
            }, 100);
        });
    </script>
    {% endunless %}
</body>
</html>
